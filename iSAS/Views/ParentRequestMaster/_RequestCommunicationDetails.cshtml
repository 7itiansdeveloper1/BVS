@model  ISas.Entities.DashboardEntities.DashBoard_ParentRequestMasterModel

<div class="box box-widget direct-chat direct-chat-warning">
    <div class="box-body no-padding">
        <div class="direct-chat-messages">
            <div class="" id="DisplayCommunicationMsgMainDiv">
                @Html.Partial("_RequestCommunication_DisplayMsg", Model.CommunicationDetailsList)
            </div>
        </div>
    </div>
    <div class="box-footer">
        @using (Html.BeginForm("ParentRequestMaster_CRUD", "ParentRequestMaster", FormMethod.Post, htmlAttributes: new { }))
        {
            @Html.HiddenFor(r => Model.Function)
            @Html.HiddenFor(r => Model.RequestId)

            <div class="input-group">
                @Html.TextBoxFor(r => Model.RequestSubject, htmlAttributes: new { style = "width:100%;", @class = "form-control", autofocus = true, title = "Press Enter to Send Message", placeholder = "Type Message ..." })
                <span class="input-group-btn">
                    <button onclick="DoAjaxPostAndMore(this)" id="btnSaveMessage" type="button" class="btn btn-warning btn-flat">Send</button>
                </span>
            </div>
        }
    </div>
</div>

<script>
    $("#RequestSubject").keydown(function (event) {
        if (event.which == 13) { //Enter
            $('#btnSaveMessage').click();
            return false;
        }
    });


    function DoAjaxPostAndMore(btnClicked) {

        if ($('#RequestSubject').val() == '' || $('#RequestSubject').val() == null) {
            $('#RequestSubject').css('border', '1px solid red');
            return false;
        } else {
            $('#RequestSubject').css('border', '1px solid #0094ff');
        }

        var $form = $(btnClicked).parents('form');
        $.ajax({
            type: "POST",
            url: $form.attr('action'),
            data: $form.serialize(),
            error: function (xhr, status, error) {
                OpenMessegeModal($('#ErrorMsgOnJasonFailed').val(), 'Warning', 'sm');
            },
            success: function (response) {
                if (response.status == 'success') {
                    $('#RequestSubject').val('');
                    fun_GetCommunicationDetails();
                    //OpenMessegeModal(response.Msg, '', 'sm');
                }
                else {
                    AddErrorAttributeCSS(response.ErrorList); //Available in CustomCommon.js
                    AddValidAttributeCSS(response.ValidKeyList); //Available in CustomCommon.js
                }
            },
        });
        return false;
    }


    function fun_GetCommunicationDetails() {
        $.ajax
            ({
                url: '../ParentRequestMaster/_RequestCommunication_DisplayMsg',
                type: 'GET',
                traditional: true,
                contentType: 'application/json',
                data: { RequestID: $('#RequestId').val() },
                success: function (result) {
                    $('#DisplayCommunicationMsgMainDiv').html(result);
                },
            });
    }
</script>
