@model ISas.Web.ViewModels.Student_PhotoUploadViewModel
<link href="~/Content/css/lightbox.min.css" rel="stylesheet" />
<div style="overflow:auto;">
    <table cellspacing="0" cellpadding="0" border="0" class="table table-bordered table-hover " id="AttendanceTable">
        <thead>
            <tr>
                <th>Adm No.</th>
                <th>Roll No.</th>
                <th>Student Photo</th>
                <th>Father Image</th>
                <th>Mother Image</th>
                <th>Guardian Image</th>
                <th>Grand Father Image</th>
                <th>Grand Mother Image</th>
                <th>Any Other Image</th>
            </tr>
        </thead>
        <tbody>
            @if (Model != null && Model.ClassPhotoList != null)
            {
                for (int i = 0; i < Model.ClassPhotoList.Count; i++)
                {
            <tr id="@i">
                <td>
                    @Html.HiddenFor(r => Model.ClassPhotoList[i].Student.StudentERPNo)
                    @Html.DisplayFor(r => Model.ClassPhotoList[i].Student.StudentAdmNo)
                </td>
                <td>@Html.DisplayFor(r => Model.ClassPhotoList[i].Student.StudentRollNo) </td>

                @*@<td>
                    @Html.HiddenFor(r => Model.ClassPhotoList[i].Student.StudentName)
                </td>*@
                <td id="S">
            <div>
                <a class="example-image-link" href="~/@Model.ClassPhotoList[i].Student.StuentPhotoURL" data-lightbox="example-set" data-title="Student Name: @Html.DisplayFor(r => Model.ClassPhotoList[i].Student.StudentName)">
                <img class="example-image" id="selfImg_@i" style="width:95px;height:95px;" src="~/@Model.ClassPhotoList[i].Student.StuentPhotoURL" />
                </a>
            </div>
            <input type="file" class="upload" style="width: 95px" />
            <br />
            @Html.DisplayFor(r => Model.ClassPhotoList[i].Student.StudentName)
        </td>
               
                <td id="F">
                    <div>
                        <a target="_blank" class="example-image-link" href="~/@Model.ClassPhotoList[i].Student.FatherPhotoURL" data-lightbox="example-set" data-title="Father Name: @Html.DisplayFor(r => Model.ClassPhotoList[i].Student.FatherName)">
                            <img class="example-image" id="fatherImg_@i" style="width:95px;height:95px;" src="~/@Model.ClassPhotoList[i].Student.FatherPhotoURL" />
                        </a>
                    </div>
                    <input type="file" class="upload" style="width: 95px" />
                    <br />
                    @Html.DisplayFor(r => Model.ClassPhotoList[i].Student.FatherName)
                </td>
                <td id="M">
                    <div>
                        <a target="_blank" class="example-image-link" href="~/@Model.ClassPhotoList[i].Student.MotherPhotoURL" data-lightbox="example-set" data-title="Mother Name: @Html.DisplayFor(r => Model.ClassPhotoList[i].Student.FatherName)">
                            <img class="example-image" id="motherImg_@i" style="width:95px;height:95px;" src="~/@Model.ClassPhotoList[i].Student.MotherPhotoURL" />
                        </a>
                    </div>

                    <input type="file" class="upload" style="width: 95px" />
                    <br />
                    @Html.DisplayFor(r => Model.ClassPhotoList[i].Student.MotherName)
                </td>
                <td id="G">

                    <div>
                        <a target="_blank" class="example-image-link" href="~/@Model.ClassPhotoList[i].Student.GardianPhotoURL" data-lightbox="example-set" data-title="Guardian Name: @Html.DisplayFor(r => Model.ClassPhotoList[i].Student.GuardianName )">
                            <img class="example-image" id="GardianImg_@i" style="width:95px;height:95px;" src="~/@Model.ClassPhotoList[i].Student.GardianPhotoURL" />
                        </a>
                    </div>
                    <input type="file" class="upload" style="width: 95px" />

                    <br />
                    @Html.DisplayFor(r => Model.ClassPhotoList[i].Student.GuardianName)
                </td>
                <td id="GF">
                    <div>
                        <a target="_blank" class="example-image-link" href="~/@Model.ClassPhotoList[i].Student.GFPhotoURL" data-lightbox="example-set">
                            <img class="example-image" id="GFImg_@i" style="width:95px;height:95px;" src="~/@Model.ClassPhotoList[i].Student.GFPhotoURL" />
                        </a>
                    </div>

                    <input type="file" class="upload" style="width: 95px" />
                </td>
                <td id="GM">

                    <div>
                        <a target="_blank" class="example-image-link" href="~/@Model.ClassPhotoList[i].Student.GMPhotoURL" data-lightbox="example-set">
                            <img class="example-image" id="GMImg_@i" style="width:95px;height:95px;" src="~/@Model.ClassPhotoList[i].Student.GMPhotoURL" />
                        </a>
                    </div>


                    <input type="file" class="upload" style="width: 95px" />
                </td>
                <td id="P">
                    <div>
                        <a target="_blank" class="example-image-link" href="~/@Model.ClassPhotoList[i].Student.PPhotoURL" data-lightbox="example-set">
                            <img class="example-image" id="PImg_@i" style="width:95px;height:95px;" src="~/@Model.ClassPhotoList[i].Student.PPhotoURL" />
                        </a>
                    </div>

                    <input type="file" class="upload" style="width: 95px" />
                </td>
            </tr>
                }
            }
        </tbody>
    </table>
</div>
<script type="text/javascript">
    $(function () {
        $('#AttendanceTable').dataTable({
            "pageLength": 50
        });
    });

     $('.upload').on('change', function (e) {
         var currentImageID = "";

         var i = $(this).closest('tr').attr('id');
         var forDocType = $(this).closest('td').attr('id');

         if (forDocType == 'S') {
             currentImageID = "selfImg_";
         } else if (forDocType == 'F') {
             currentImageID = "fatherImg_";
         }
         else if (forDocType == 'M') {
             currentImageID = "motherImg_";
         }
         else if (forDocType == 'G') {
             currentImageID = "GardianImg_";
         }
         else if (forDocType == 'GF') {
             currentImageID = "GFImg_";
         }
         else if (forDocType == 'GM') {
             currentImageID = "GMImg_";
         }
         else if (forDocType == 'P') {
             currentImageID = "PImg_";
         }

         if (this.files && this.files[0]) {
             var reader = new FileReader();
             reader.onload = function (e) {
                 $('#' + currentImageID + i)
                     .attr('src', e.target.result)
                     .width(95)
                     .height(95);
             };
             reader.readAsDataURL(this.files[0]);
         }


         var files = e.target.files;
         if (files.length > 0) {
             if (window.FormData !== undefined) {
                 var data = new FormData();
                 for (var x = 0; x < files.length; x++) {

                     data.append("id" + x, files[x]);
                 }
                 data.append('StudentERPNo', $('#ClassPhotoList_' + i + '__Student_StudentERPNo').val());

                 data.append('ForDocType', forDocType);
                 $.ajax({
                     type: "POST",
                     url: '@Url.Action("UploadFile", "Student_PhotoUpload")',
                     dataType: 'json',
                     contentType: false,
                     processData: false,
                     data: data,
                     success: function (result) {
                         OpenMessegeModal(result);
                     },
                     error: function () {
                         OpenMessegeModal($('#ErrorMsgOnJasonFailed').val());
                     },
                 });
             } else {
                 OpenMessegeModal('This browser does not support HTML5 file uploads!');
             }
         }
     });
</script>
