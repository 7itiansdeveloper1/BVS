@model ISas.Entities.TimeTable_Entities.TimeTable_PeriodTimingSetupModels

<link rel="stylesheet" href="../plugins/timepicker/bootstrap-timepicker.min.css">
<script src="../plugins/timepicker/bootstrap-timepicker.min.js"></script>

<!-- InputMask -->
<script src="../plugins/input-mask/jquery.inputmask.js"></script>
<script src="../plugins/input-mask/jquery.inputmask.date.extensions.js"></script>
<script src="../plugins/input-mask/jquery.inputmask.extensions.js"></script>

<section class="content-header">
    <h1>Time Setup</h1>
    <ol class="breadcrumb">
        <li>
            <a href="javascript: history.go(-1)" title="Back"><i class="fa fa-arrow-left"></i> </a> |
            <a href="#" onclick="window.location.reload()" title="Refresh"><i class="fa fa-refresh"></i></a> |
            <a href="@Url.Action("Dashboard", "Dashboard")" title="Dashboard"><i class="fa fa-dashboard"></i></a>
        </li>
        <li>Time Table</li>
        <li><a href="@Url.Action("LandingPage", "TimeTable_Setup")">Timetable Setup</a></li>
        <li class="active">Time Setup</li>
    </ol>
</section>

<section class="content">
    @using (Html.BeginForm("TimeTable_PeriodTimingSetup_CRUD", "TimeTable_PeriodTimingSetup", FormMethod.Post, htmlAttributes: new { }))
    {
        @Html.HiddenFor(r => Model.ClassSectionId)

        <div class="box box-primary">
            <div class="box-header with-border">
                <h5 class="box-title">Class : @Html.DisplayFor(r => Model.ClassSectionName), Class Teacher : <span class="text-primary"> @Html.DisplayFor(r => Model.ClassTeacherName) </span> </h5>
                <h5 class="box-title pull-right">
                    <input type="button" class="btn btn-primary btn-sm" value="SAVE" onclick="DoAjaxPostAndMore(this)" />
                </h5>
            </div>
            <div class="box-body">
                <div class="row">
                    <div class="col-md-1">
                        <label>Season : </label>
                    </div>
                    <div class="col-md-2">
                        @Html.DropDownListFor(r => Model.SeasonId, new SelectList(Model.SeasonList, "Value", "Text"), "--Select--", htmlAttributes: new { @class = "form-control select2", style = "width:100%;", onchange = "getPeriodTimeDetails()" })
                    </div>
                </div>
                <hr />

                <div id="periodTimingDetailMainDiv">
                    @Html.Partial("_PeriodTimingDetails", Model)
                </div>

              
            </div>
        </div>
    }
</section>

<script>
    function getPeriodTimeDetails() {
        $.ajax({
            type: "GET",
            beforeSend: function () {
                spinnerShow();
            },
            url: '../TimeTable_PeriodTimingSetup/_PeriodTimingDetails',
            data: { ClassSectionId: $('#ClassSectionId').val(), SeasonId: $('#SeasonId').val() },
            error: function (xhr, status, error) {
                OpenMessegeAutoHideDiv($('#ErrorMsgOnJasonFailed').val(), 'Danger');
            },
            success: function (response) {
                $('#periodTimingDetailMainDiv').html(response);
            },
            complete: function () {
                spinnerHide();
            }
        });
    }
    function DoAjaxPostAndMore(btnClicked) {
        var $form = $(btnClicked).parents('form');
        $.ajax({
            type: "POST",
            beforeSend: function () {
                spinnerShow();
            },
            url: $form.attr('action'),
            data: $form.serialize(),
            error: function (xhr, status, error) {
                OpenMessegeAutoHideDiv($('#ErrorMsgOnJasonFailed').val(), 'Danger');
            },
            success: function (response) {
                if (response.status == 'success') {
                    OpenMessegeAutoHideDiv(response.Msg, response.Color);
                }
                else {
                    OpenMessegeAutoHideDiv($('#ErrorMsgOnModelStateNotValid').val());
                    AddErrorAttributeCSS(response.ErrorList); //Available in CustomCommon.js
                    AddValidAttributeCSS(response.ValidKeyList); //Available in CustomCommon.js
                }
            },
            complete: function () {
                spinnerHide();
            }
        });
    }

    function fun_ConfirmCopyToClass() {
        var selectedCount = 0; var selectedClassSecIds = '';
        $('#tblCopyToClass > tbody > tr').each(function (i) {
            if ($('#ClassList_' + i + '__Selected').is(':checked')) {
                if (selectedClassSecIds == '') {
                    selectedClassSecIds = $('#ClassList_' + i + '__Value').val();
                } else {
                    selectedClassSecIds += ',' + $('#ClassList_' + i + '__Value').val();
                }
                selectedCount++;
            }
        });
        if (selectedCount > 0) {
            CopyToClassConfirm(selectedClassSecIds);
        }
        else {
            OpenMessegeAutoHideDiv('No class is selected to copy..!', 'Info');
        }
    }

    function CopyToClassConfirm(selectedClassSecIds) {
        AsyncConfirmYesNo("Confirmation", "Are you sure to copy to selected classes.?", MyYesFunction, MyNoFunction, selectedClassSecIds);
    }

    function MyYesFunction(selectedClassSecIds) {
        $.ajax({
            type: "GET",
            beforeSend: function () {
                spinnerShow();
            },
            url: "../TimeTable_PeriodTimingSetup/TimeTable_PeriodTimingSetup_CopyToClass",
            data: { SeasonId: $('#SeasonId').val(), FromClassSecId: $('#ClassSectionId').val(), ToClassSecId: selectedClassSecIds},
            error: function (xhr, status, error) {
                OpenMessegeAutoHideDiv($('#ErrorMsgOnJasonFailed').val(), 'Danger');
            },
            success: function (result) {
                OpenMessegeAutoHideDiv(result.Msg, result.Color);
                setTimeout(function () { window.location.reload(); }, $('#hddnReloadTime').val());
            },
            complete: function () {
                spinnerHide();
            }
        });
    }
    function MyNoFunction() {
        //alert('No Calling');
    }
</script>
